<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entrar â€¢ Milton Motos e PeÃ§as</title>
  <meta name="description" content="Tela de login e cadastro do sistema Milton Motos e PeÃ§as" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand-red:#C62828; --brand-blue:#0D47A1; --brand-white:#fff;
      --bg:#0f172a; --panel:#111827; --panel-2:#0b1220; --muted:#94a3b8; --text:#e5e7eb;
      --ring:0 0 0 3px rgba(13,71,161,.35); --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px; --radius-sm:12px
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:radial-gradient(1200px 600px at 80% -10%,rgba(13,71,161,.25),transparent 40%),radial-gradient(1000px 500px at -10% 20%,rgba(198,40,40,.25),transparent 45%),var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}

    .wrap{min-height:100dvh;display:grid;grid-template-columns:1.05fr .95fr}
    @media (max-width:960px){.wrap{grid-template-columns:1fr}}

    /* Lateral visual */
    .hero{position:relative;display:grid;place-items:center;padding:40px}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(198,40,40,.15),rgba(13,71,161,.15));pointer-events:none}
    .brand{
      display:flex;align-items:center;gap:12px;font-weight:700;letter-spacing:.3px
    }
    .logo{width:48px;height:48px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand-red),var(--brand-blue));box-shadow:var(--shadow)}

    /* Card */
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}

    .panel{display:grid;align-content:center;padding:40px}
    .tabs{display:flex;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .tabs button{flex:1;border:0;padding:12px 14px;color:#cbd5e1;background:transparent;cursor:pointer}
    .tabs button.active{color:#fff;background:linear-gradient(135deg,var(--brand-blue),#0b3c86)}

    .form{display:grid;gap:14px;margin-top:16px}
    .field{display:grid;gap:6px}
    .label{font-size:13px;color:var(--muted)}
    .control{display:flex;align-items:center;gap:8px;background:var(--panel-2);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px}
    .control input{flex:1;background:transparent;border:0;outline:0;color:var(--text)}
    .control:has(input:focus){box-shadow:var(--ring)}
    .eye{cursor:pointer;opacity:.9}

    .row{display:flex;justify-content:space-between;align-items:center}
    .row a{color:#cbd5e1}

    .btn{cursor:pointer;border:0;border-radius:12px;padding:12px 14px;display:inline-flex;align-items:center;justify-content:center;gap:8px}
    .btn-primary{background:linear-gradient(135deg,var(--brand-red),#a22323);color:#fff}
    .btn-primary[disabled]{opacity:.6;cursor:not-allowed}

    .help{font-size:13px;color:var(--muted)}

    .alert{border:1px solid rgba(239,68,68,.35);background:rgba(239,68,68,.15);padding:10px 12px;border-radius:12px;color:#fecaca}
    .success{border:1px solid rgba(16,185,129,.4);background:rgba(16,185,129,.15);color:#d1fae5}

    .footer{color:var(--muted);text-align:center;margin-top:20px}
  </style>
</head> 
<body>
  <div class="wrap">
    <section class="hero">
      <div class="card" style="max-width:520px">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M5 17h14l-1 3H6l-1-3Zm13.5-4c.83 0 1.5.67 1.5 1.5S19.33 16 18.5 16 17 15.33 17 14.5s.67-1.5 1.5-1.5ZM5.5 13c.83 0 1.5.67 1.5 1.5S6.33 16 5.5 16 4 15.33 4 14.5 4.67 13 5.5 13ZM3 6h9l3 3h6v5H3V6Z"/></svg>
          </div>
          <span>Milton Motos e PeÃ§as</span>
        </div>
        <h1 style="margin:14px 0 4px">Bem-vinda de volta ðŸ‘‹</h1>
        <p class="help" style="margin:0">FaÃ§a login ou crie sua conta para acessar o nosso sistema!.</p>
      </div>
    </section>

    <section class="panel">
      <div style="max-width:460px;margin-inline:auto">
        <div class="tabs">
          <button class="active" id="tabLogin" aria-controls="viewLogin">Entrar</button>
          <button id="tabCadastro" aria-controls="viewCadastro">Cadastrar</button>
        </div>

        <!-- LOGIN -->
        <div id="viewLogin" class="card" style="margin-top:12px">
          <form id="formLogin" class="form" novalidate>
            <div id="msgLogin" role="status"></div>
            <div class="field">
              <span class="label">E-mail</span>
              <div class="control"><input id="email" type="email" autocomplete="email" placeholder="Email" required></div>
            </div>
            <div class="field">
              <span class="label">Senha</span>
              <div class="control"><input id="senha" type="password" autocomplete="current-password" required><svg class="eye" id="eyeLogin" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/></svg></div>
            </div>
            <div class="row">
              <label style="display:flex;gap:8px;align-items:center;font-size:13px;color:#cbd5e1"><input id="lembrar" type="checkbox"> Lembrar de mim</label>
              
              <a href="#" title="Em breve">Esqueci a senha</a>
            </div>
            <button class="btn btn-primary" id="btnLogin" type="submit">Entrar</button>
          </form>
        </div>

        <!-- CADASTRO -->
        <div id="viewCadastro" class="card" style="margin-top:12px;display:none">
          <form id="formCadastro" class="form" novalidate>
            <div id="msgCadastro" role="status"></div>
            <div class="field">
              <span class="label">Nome</span>
              <div class="control"><input id="nome" name="nome" type="text" autocomplete="name" placeholder="Seu nome" required></div>
            </div>
            <div class="field">
              <span class="label">E-mail</span>
              <div class="control"><input id="emailCadastro" name="email" type="email" autocomplete="email" placeholder="voce@exemplo.com" required></div>
            </div>
            <div class="field">
              <span class="label">Senha</span>
              <div class="control"><input id="senhaCadastro" name="senha" type="password" autocomplete="new-password" minlength="6" required><svg class="eye" id="eyeCadastro" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/></svg></div>
            </div>
            <button class="btn btn-primary" id="btnCadastro" type="submit">Criar conta</button>
            <p class="help">Ao continuar vocÃª concorda com os termos de uso e privacidade.</p>
          </form>
        </div>

        <p class="footer">Â© <span id="ano"></span> Milton Motos e PeÃ§as</p>
      </div>
    </section>
  </div>

<script>

// ====== EVITA ACESSO AO LOGIN SE JÃ ESTIVER LOGADO ======
  const token = localStorage.getItem('token');

  if (token) {
    window.location.replace('dashboard.html');
  }

  // ====== CONFIG ======
  const API_LOGIN = '/api/auth/login';
  // ajuste se seu backend usar "/register":
  const API_CADASTRO = '/api/auth/cadastro';
  const DASHBOARD_URL = 'dashboard.html'; // altere se necessÃ¡rio

  // ====== Tabs ======
  const tabLogin = document.getElementById('tabLogin');
  const tabCadastro = document.getElementById('tabCadastro');
  const viewLogin = document.getElementById('viewLogin');
  const viewCadastro = document.getElementById('viewCadastro');
  tabLogin.addEventListener('click', ()=> {toggleTab(true)});
  tabCadastro.addEventListener('click', ()=> {toggleTab(false)});
  function toggleTab(isLogin){
    tabLogin.classList.toggle('active', isLogin);
    tabCadastro.classList.toggle('active', !isLogin);
    viewLogin.style.display = isLogin ? '' : 'none';
    viewCadastro.style.display = isLogin ? 'none' : '';
  }

  // ====== Util ======
  const ano = document.getElementById('ano');
  ano.textContent = new Date().getFullYear();
  function showMsg(el, text, ok=false){
    el.className = ok ? 'success' : 'alert';
    el.textContent = text;
  }
  function clearMsg(el){ el.className = ''; el.textContent = ''; }
  function togglePassword(input, btn){
    const show = input.type === 'password';
    input.type = show ? 'text' : 'password';
  }
  document.getElementById('eyeLogin').addEventListener('click', ()=> togglePassword(document.getElementById('senha')));
  document.getElementById('eyeCadastro').addEventListener('click', ()=> togglePassword(document.getElementById('senhaCadastro')));

  // ====== Login ======

document.addEventListener('DOMContentLoaded', () => {

  const token = localStorage.getItem('token');
  if (token) {
    window.location.replace('/dashboard.html');
    return;
  }

  const form = document.getElementById('formLogin');
  const emailInput = document.getElementById('email');
  const senhaInput = document.getElementById('senha');
  const msg = document.getElementById('msgLogin');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = '';

    const email = emailInput.value.trim();
    const senha = senhaInput.value.trim();

    if (!email || !senha) {
      msg.textContent = 'Informe email e senha';
      msg.className = 'alert';
      return;
    }

    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, senha })
      });

      const data = await res.json();

      if (!res.ok) {
        msg.textContent = data.erro || 'Erro ao entrar';
        msg.className = 'alert';
        return;
      }

      localStorage.setItem('token', data.token);
      localStorage.setItem('usuario', JSON.stringify(data.usuario));
      window.location.href = '/dashboard.html';

    } catch (err) {
      msg.textContent = 'Erro de conexÃ£o com o servidor';
      msg.className = 'alert';
    }
  });

});

  // ====== Cadastro ======
  const formCadastro = document.getElementById('formCadastro');
  const msgCadastro = document.getElementById('msgCadastro');
  const btnCadastro = document.getElementById('btnCadastro');

  formCadastro.addEventListener('submit', async (e)=>{
    e.preventDefault();
    clearMsg(msgCadastro);
    const nome = document.getElementById('nome').value.trim();
    const email = document.getElementById('emailCadastro').value.trim();
    const senha = document.getElementById('senhaCadastro').value.trim();
    if(!nome || !email || !senha){ return showMsg(msgCadastro, 'Preencha todos os campos.'); }
    if(senha.length < 6){ return showMsg(msgCadastro, 'A senha precisa ter pelo menos 6 caracteres.'); }
    btnCadastro.disabled = true;
    try{
      const res = await fetch(API_CADASTRO, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ nome, email, senha })
      });
      const data = await res.json().catch(()=>({}));
      if(!res.ok){ throw new Error(data.error || data.message || 'Falha no cadastro'); }
      // opcional: jÃ¡ logar apÃ³s cadastro, se sua API retornar token/usuario
      if(data.token) localStorage.setItem('token', data.token);
      if(data.usuario) localStorage.setItem('usuario', JSON.stringify(data.usuario));
      showMsg(msgCadastro, 'Cadastro concluÃ­do! Redirecionando...', true);
      setTimeout(()=>{ window.location.href = DASHBOARD_URL; }, 600);
    }catch(err){
      showMsg(msgCadastro, 'Erro: ' + err.message);
    }finally{
      btnCadastro.disabled = false;
    }
  });
</script>
</body>
</html>
