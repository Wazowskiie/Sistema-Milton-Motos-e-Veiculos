<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Milton Motos e Pe√ßas ‚Äî Estoque Avan√ßado</title>
  <meta name="description" content="Sistema de gest√£o de estoque avan√ßado ‚Äî Milton Motos e Pe√ßas" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Cores da marca */
      --brand-red: #C62828;
      --brand-blue: #0D47A1;
      --brand-white: #ffffff;
      --bg: #0f172a;          /* slate-900 */
      --panel: #111827;       /* gray-900 */
      --panel-2: #0b1220;     /* fundo cards */
      --muted: #94a3b8;       /* slate-400 */
      --text: #e5e7eb;        /* gray-200 */
      --ok: #16a34a;
      --warn: #f59e0b;
      --danger: #ef4444;
      --ring: 0 0 0 3px rgba(13,71,161,.3);
      --shadow-lg: 0 10px 30px rgba(0,0,0,.35);
      --shadow-md: 0 6px 18px rgba(0,0,0,.25);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-xl: 24px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 80% -10%, rgba(13,71,161,.25), transparent 40%),
                  radial-gradient(1000px 500px at -10% 20%, rgba(198,40,40,.25), transparent 45%),
                  var(--bg);
      color: var(--text);
      line-height:1.45;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{color:inherit;text-decoration:none}
    button{font:inherit;cursor:pointer}

    .app{
      display:grid;
      grid-template-rows: auto 1fr;
      min-height:100dvh;
    }

    /* Header */
    .header{
      position:sticky; top:0; z-index:50;
      background: linear-gradient(180deg, rgba(17,24,39,.9), rgba(17,24,39,.75));
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .header-inner{
      max-width:1200px; margin:0 auto;
      display:flex; align-items:center; gap:16px;
      padding:14px 20px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:700; letter-spacing:.3px;
    }
    .logo{
      width:40px; height:40px; border-radius:12px; overflow:hidden;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--brand-red), var(--brand-blue));
      box-shadow: var(--shadow-md);
    }
    .brand-title{font-size: clamp(16px, 2vw, 20px)}

    /* Nav */
    .nav{margin-left:auto; display:flex; align-items:center; gap:8px}
    .nav a{
      padding:10px 14px; border-radius:10px; color: var(--muted);
      transition: all 0.2s ease;
    }
    .nav a.active, .nav a:hover{color:var(--brand-white); background: rgba(255,255,255,.06)}

    .btn{cursor:pointer; border:0; border-radius:12px; padding:10px 14px; display:inline-flex; align-items:center; gap:8px; transition: all 0.2s ease}
    .btn-primary{background: linear-gradient(135deg, var(--brand-blue), #0b3c86); color:#fff; box-shadow: var(--shadow-md)}
    .btn-primary:hover{filter:brightness(1.05); transform: translateY(-1px)}
    .btn-ghost{background: transparent; color: var(--text)}
    .btn-ghost:hover{background: rgba(255,255,255,.06)}

    /* Layout */
    .container{max-width:1200px; margin:0 auto; padding:24px 20px}

    /* Cards */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);
      box-shadow: var(--shadow-lg);
      border-radius: var(--radius);
      padding:18px;
    }

    /* Tabs Navigation */
    .tabs-nav{
      display:flex; gap:8px; margin-bottom:24px;
      background: var(--panel-2);
      padding:6px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.06);
      overflow-x:auto;
    }
    .tab-btn{
      background:transparent; color:var(--muted); border:0;
      padding:12px 18px; border-radius:10px; font-weight:500;
      white-space:nowrap; transition: all 0.2s ease;
      display:flex; align-items:center; gap:8px;
    }
    .tab-btn.active{
      background: linear-gradient(135deg, var(--brand-blue), #0b3c86);
      color:#fff; box-shadow: var(--shadow-md);
    }
    .tab-btn:hover:not(.active){
      color:var(--text); background: rgba(255,255,255,.06);
    }

    /* Tab Content */
    .tab-content{display:none; animation: fadeIn 0.3s ease}
    .tab-content.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* Hero Section */
    .hero{
      background: radial-gradient(800px 300px at 20% -30%, rgba(13,71,161,.25), transparent 40%),
                  radial-gradient(600px 260px at 100% 120%, rgba(198,40,40,.22), transparent 55%),
                  linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border-radius: var(--radius);
      padding:24px;
      margin-bottom:24px;
      border:1px solid rgba(255,255,255,.06);
      box-shadow: var(--shadow-lg);
    }
    .hero h1{
      margin:8px 0 6px; font-size: clamp(24px, 3.4vw, 36px);
      background: linear-gradient(135deg, var(--brand-blue), var(--brand-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p{color: var(--muted); margin:0; font-size:16px}

    /* Form Grid */
    .form-grid{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
      gap:16px; margin-bottom:20px;
    }
    .form-group{display:flex; flex-direction:column; gap:6px}
    .form-group label{
      font-size:12px; color:var(--muted); text-transform:uppercase;
      letter-spacing:.08em; font-weight:600;
    }
    .form-group input, .form-group select{
      padding:12px 14px; border:1px solid rgba(255,255,255,.08);
      border-radius:10px; background:var(--panel-2); color:var(--text);
      transition: all 0.2s ease;
    }
    .form-group input:focus, .form-group select:focus{
      outline:0; border-color:var(--brand-blue);
      box-shadow: var(--ring);
    }

    /* Search */
    .search{
      display:flex; align-items:center; gap:10px; flex:1; min-width:220px;
      background: var(--panel-2); border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:10px 12px; margin-bottom:20px;
    }
    .search input{flex:1; background:transparent; border:0; outline:0; color:var(--text)}

    /* Table */
    .table-wrap{overflow:auto; border-radius:14px; border:1px solid rgba(255,255,255,.06)}
    table{width:100%; border-collapse:collapse; min-width:760px; background: rgba(255,255,255,.02)}
    thead th{
      position:sticky; top:0; 
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      text-align:left; padding:12px; font-size:12px; text-transform:uppercase;
      letter-spacing:.08em; color:var(--muted); font-weight:600;
    }
    tbody td{padding:14px 12px; border-top:1px solid rgba(255,255,255,.06)}
    tbody tr:hover{background: rgba(255,255,255,.03)}

    /* Badges */
    .badge{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px;
      border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.12);
      font-weight:500;
    }
    .badge.blue{background:rgba(13,71,161,.12); color:var(--brand-blue)}
    .badge.red{background:rgba(198,40,40,.12); color:var(--brand-red)}
    .badge.green{background:rgba(22,163,74,.12); color:var(--ok)}
    .badge.yellow{background:rgba(245,158,11,.12); color:var(--warn)}

    /* Status Badges */
    .status-disponivel{background:rgba(22,163,74,.12); color:var(--ok)}
    .status-baixo{background:rgba(245,158,11,.12); color:var(--warn)}
    .status-esgotado{background:rgba(239,68,68,.12); color:var(--danger)}

    /* Code de Barras Display */
    .barcode-display{
      background: var(--panel-2);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:24px;
      text-align:center;
      margin:20px 0;
    }
    .barcode-number{
      font-family: 'Courier New', monospace;
      font-size:24px; font-weight:bold;
      color:var(--text); margin-bottom:12px;
    }
    .barcode-visual{
      font-family: 'Courier New', monospace;
      font-size:32px; color:var(--brand-blue);
      letter-spacing:2px; margin-bottom:16px;
    }

    /* KPIs */
    .kpis{display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:16px; margin-bottom:24px}
    .kpi{
      padding:18px; border-radius:14px; background: var(--panel-2);
      border:1px solid rgba(255,255,255,.06);
    }
    .kpi .label{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.08em}
    .kpi .value{font-size: clamp(20px, 3vw, 28px); font-weight:700; margin-top:8px; color:var(--text)}
    .kpi .trend{font-size:12px; margin-top:8px}
    .trend.up{color:var(--ok)}
    .trend.down{color:var(--danger)}

    /* Alerts */
    .alert{
      padding:14px 16px; border-radius:12px; margin:16px 0;
      display:flex; align-items:center; gap:10px;
    }
    .alert-success{
      background:rgba(22,163,74,.1); border:1px solid rgba(22,163,74,.2);
      color:var(--ok);
    }
    .alert-warning{
      background:rgba(245,158,11,.1); border:1px solid rgba(245,158,11,.2);
      color:var(--warn);
    }
    .alert-danger{
      background:rgba(239,68,68,.1); border:1px solid rgba(239,68,68,.2);
      color:var(--danger);
    }

    /* Loading */
    .loading{
      text-align:center; padding:40px; color:var(--muted);
      font-style:italic;
    }

    /* Toolbar */
    .toolbar{
      display:flex; flex-wrap:wrap; gap:12px; align-items:center;
      justify-content:space-between; margin-bottom:20px;
    }

    /* Action Buttons */
    .actions{display:flex; gap:8px}
    .btn-sm{padding:8px 12px; font-size:12px; border-radius:8px}

    /* Acessibilidade */
    :is(a,button,input,select){outline:none}
    :is(a,button,input,select):focus-visible{box-shadow: var(--ring)}

    /* Responsive */
    @media (max-width:920px){
      .form-grid{grid-template-columns:1fr}
      .toolbar{flex-direction:column; align-items:stretch}
      .search{min-width:unset}
    }

    @media (max-width:640px){
      .container{padding:16px}
      .tabs-nav{flex-direction:column}
      .tab-btn{justify-content:center}
      .hero{padding:20px}
      .kpis{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
            <path d="M5 17h14l-1 3H6l-1-3Zm13.5-4c.83 0 1.5.67 1.5 1.5S19.33 16 18.5 16 17 15.33 17 14.5s.67-1.5 1.5-1.5ZM5.5 13c.83 0 1.5.67 1.5 1.5S6.33 16 5.5 16 4 15.33 4 14.5 4.67 13 5.5 13ZM3 6h9l3 3h6v5H3V6Z"/>
          </svg>
        </div>
        <span class="brand-title">Milton Motos e Pe√ßas</span>
      </div>

      <nav class="nav" aria-label="Navega√ß√£o principal">
        <a href="/">Dashboard</a>
        <a href="/produtos.html">Pe√ßas</a>
        <a href="/vendas.html">Vendas</a>
        <a href="#" class="active">Estoque</a>
        <button class="btn btn-ghost" title="Sair" aria-label="Sair">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M16 13v-2H7V8l-5 4 5 4v-3h9Z"/>
            <path d="M20 3h-8v2h8v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z"/>
          </svg>
          Sair
        </button>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <!-- Hero Section -->
    <section class="hero">
      <h1>üèçÔ∏è Gest√£o de Estoque Avan√ßada</h1>
      <p>Sistema integrado com c√≥digo de barras, hist√≥rico de pre√ßos e sincroniza√ß√£o autom√°tica com fornecedores</p>
    </section>

    <!-- Tabs Navigation -->
    <nav class="tabs-nav" role="tablist">
      <button class="tab-btn active" role="tab" onclick="showTab('produtos')" aria-selected="true">
        üì¶ Produtos e C√≥digo de Barras
      </button>
      <button class="tab-btn" role="tab" onclick="showTab('precos')" aria-selected="false">
        üí∞ Hist√≥rico de Pre√ßos
      </button>
      <button class="tab-btn" role="tab" onclick="showTab('fornecedores')" aria-selected="false">
        üöö Fornecedores
      </button>
      <button class="tab-btn" role="tab" onclick="showTab('relatorios')" aria-selected="false">
        üìä Relat√≥rios
      </button>
    </nav>

    <!-- Tab: Produtos e C√≥digo de Barras -->
    <section id="produtos" class="tab-content active card" role="tabpanel">
      <h2 style="margin:0 0 20px; font-size:20px">üì¶ Produtos e C√≥digos de Barras</h2>
      
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23 6.5 6.5 0 1 0-6.5 6.5 6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5Zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14Z"/>
        </svg>
        <input id="searchProdutos" type="search" placeholder="Buscar por nome, c√≥digo ou c√≥digo de barras..." aria-label="Buscar produto">
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="produtoSelect">Produto Existente</label>
          <select id="produtoSelect" onchange="carregarProdutoSelecionado()">
            <option value="">Selecione um produto...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="tipoCodigoBarras">Tipo de C√≥digo de Barras</label>
          <select id="tipoCodigoBarras">
            <option value="EAN13">EAN-13 (Padr√£o)</option>
            <option value="EAN8">EAN-8</option>
            <option value="CODE128">Code 128</option>
            <option value="CODE39">Code 39</option>
          </select>
        </div>
      </div>

      <div class="toolbar">
        <div style="display:flex; gap:12px">
          <button class="btn btn-primary" onclick="gerarCodigoBarras()">
            üìã Gerar C√≥digo de Barras
          </button>
          <button class="btn btn-ghost" onclick="buscarPorCodigo()">
            üîç Buscar por C√≥digo
          </button>
          <button class="btn btn-ghost" onclick="carregarProdutos()">
            üîÑ Atualizar Lista
          </button>
        </div>
      </div>

      <div id="codigoBarrasResult" style="display: none;" class="barcode-display">
        <div class="barcode-number" id="codigoNumero"></div>
        <div class="barcode-visual">||||| |||| | |||||||||</div>
        <button class="btn btn-ghost" onclick="imprimirCodigo()">
          üñ®Ô∏è Imprimir
        </button>
      </div>

      <div class="table-wrap" role="region" aria-label="Lista de produtos">
        <table>
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Nome</th>
              <th>Tipo</th>
              <th>Pre√ßo</th>
              <th>Estoque</th>
              <th>Status</th>
              <th>C√≥digo de Barras</th>
              <th style="text-align:right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="produtosTableBody">
            <tr>
              <td colspan="8" class="loading">üîÑ Carregando produtos...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Tab: Hist√≥rico de Pre√ßos -->
    <section id="precos" class="tab-content card" role="tabpanel">
      <h2 style="margin:0 0 20px; font-size:20px">üí∞ Hist√≥rico de Pre√ßos</h2>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="produtoPreco">Produto</label>
          <select id="produtoPreco" onchange="carregarHistoricoPrecos()">
            <option value="">Selecione um produto...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="novoPreco">Novo Pre√ßo (R$)</label>
          <input type="number" id="novoPreco" placeholder="0,00" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label for="motivoAlteracao">Motivo da Altera√ß√£o</label>
          <select id="motivoAlteracao">
            <option value="">Selecione o motivo...</option>
            <option value="promocao">Promo√ß√£o</option>
            <option value="ajuste_custo">Ajuste de Custo</option>
            <option value="concorrencia">Concorr√™ncia</option>
            <option value="sazonalidade">Sazonalidade</option>
            <option value="margem_lucro">Ajuste de Margem</option>
            <option value="outros">Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label for="observacoesPreco">Observa√ß√µes</label>
          <input type="text" id="observacoesPreco" placeholder="Observa√ß√µes opcionais...">
        </div>
      </div>

      <button class="btn btn-primary" onclick="atualizarPreco()">
        üí∞ Atualizar Pre√ßo
      </button>

      <div style="margin-top:30px">
        <h3 style="margin-bottom:16px; font-size:16px">üìà Hist√≥rico de Altera√ß√µes</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Produto</th>
                <th>Pre√ßo Anterior</th>
                <th>Novo Pre√ßo</th>
                <th>Varia√ß√£o</th>
                <th>Motivo</th>
              </tr>
            </thead>
            <tbody id="historicoTableBody">
              <tr>
                <td colspan="6" class="loading">Selecione um produto para ver o hist√≥rico</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Tab: Fornecedores -->
    <section id="fornecedores" class="tab-content card" role="tabpanel">
      <h2 style="margin:0 0 20px; font-size:20px">üöö Integra√ß√£o com Fornecedores</h2>
      
      <div class="alert alert-warning">
        ‚ö†Ô∏è Esta funcionalidade requer configura√ß√£o t√©cnica. Entre em contato com o suporte para configurar integra√ß√µes autom√°ticas.
      </div>

      <div style="margin-top:20px">
        <h3 style="margin-bottom:16px; font-size:16px">Fornecedores Configurados</h3>
        <div id="fornecedoresList" class="loading">üîÑ Carregando integra√ß√µes...</div>
      </div>
    </section>

    <!-- Tab: Relat√≥rios -->
    <section id="relatorios" class="tab-content card" role="tabpanel">
      <h2 style="margin:0 0 20px; font-size:20px">üìä Relat√≥rios e Estat√≠sticas</h2>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="periodoRelatorio">Per√≠odo</label>
          <select id="periodoRelatorio">
            <option value="7">√öltimos 7 dias</option>
            <option value="30" selected>√öltimos 30 dias</option>
            <option value="90">√öltimos 90 dias</option>
          </select>
        </div>
      </div>

      <button class="btn btn-primary" onclick="gerarRelatorios()">
        üìä Gerar Relat√≥rios
      </button>

      <div id="relatoriosContent" style="margin-top:30px">
        <div class="loading">üìä Clique em "Gerar Relat√≥rios" para ver as estat√≠sticas</div>
      </div>
    </section>
  </main>
</div>

<script>
  // Configura√ß√£o da API
  const API_BASE = '/api/estoque';

  // Estado da aplica√ß√£o
  let produtosSistema = [];
  let produtoSelecionado = null;

  // Fun√ß√£o para mostrar tabs
  function showTab(tabName) {
    // Esconder todas as tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Remover classe active dos bot√µes e atualizar aria-selected
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
    });
    
    // Mostrar tab selecionada
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
    event.target.setAttribute('aria-selected', 'true');
  }

  // Fun√ß√£o para mostrar alertas
  function mostrarAlerta(mensagem, tipo = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${tipo}`;
    alertDiv.innerHTML = `
      ${tipo === 'success' ? '‚úÖ' : tipo === 'danger' ? '‚ùå' : '‚ö†Ô∏è'} ${mensagem}
      <button onclick="this.parentElement.remove()" style="margin-left:auto; background:none; border:none; color:inherit; font-size:18px; cursor:pointer; opacity:0.7; padding:0 4px">&times;</button>
    `;
    alertDiv.style.display = 'flex';
    alertDiv.style.justifyContent = 'space-between';
    alertDiv.style.alignItems = 'center';
    
    const container = document.querySelector('main');
    container.insertBefore(alertDiv, container.children[1]);
    
    setTimeout(() => {
      if (alertDiv.parentElement) {
        alertDiv.remove();
      }
    }, 5000);
  }

  // Carregar produtos do sistema
  async function carregarProdutos() {
    try {
      let produtos = [];
      
      try {
        const response = await fetch('/api/produtos');
        if (response.ok) {
          const data = await response.json();
          produtos = data.data || data;
        }
      } catch (e) {
        console.log('Usando dados de exemplo');
      }

      // Dados de exemplo baseados no seu sistema
      if (!produtos.length) {
        produtos = [
          {
            _id: '1',
            codigo: 'MM-0001',
            nome: 'Filtro de √ìleo Honda',
            preco: 29.90,
            quantidade: 48,
            tipo: 'Motor',
            status: 'Dispon√≠vel'
          },
          {
            _id: '2', 
            codigo: 'MM-0123',
            nome: 'Pastilha de Freio Yamaha',
            preco: 59.90,
            quantidade: 12,
            tipo: 'Freio',
            status: 'Baixo'
          }
        ];
      }

      produtosSistema = produtos;
      atualizarTabelaProdutos();
      atualizarSelectProdutos();
      mostrarAlerta('Produtos carregados com sucesso!', 'success');
      
    } catch (error) {
      console.error('Erro ao carregar produtos:', error);
      mostrarAlerta('Erro ao carregar produtos: ' + error.message, 'danger');
    }
  }

  // Atualizar tabela de produtos
  function atualizarTabelaProdutos() {
    const tbody = document.getElementById('produtosTableBody');
    
    if (!produtosSistema.length) {
      tbody.innerHTML = '<tr><td colspan="8" class="loading">Nenhum produto encontrado</td></tr>';
      return;
    }

    tbody.innerHTML = '';
    
    produtosSistema.forEach(produto => {
      const statusClass = produto.quantidade > 20 ? 'status-disponivel' : 
                         produto.quantidade > 0 ? 'status-baixo' : 'status-esgotado';
      const statusText = produto.quantidade > 20 ? 'Dispon√≠vel' : 
                        produto.quantidade > 0 ? 'Baixo' : 'Esgotado';
      
      const tipoClass = produto.tipo === 'Freio' ? 'red' : 'blue';
      
      const row = tbody.insertRow();
      row.innerHTML = `
        <td>${produto.codigo || produto.sku || '-'}</td>
        <td>${produto.nome}</td>
        <td><span class="badge ${tipoClass}">${produto.tipo || '-'}</span></td>
        <td>R$ ${produto.preco.toFixed(2)}</td>
        <td>${produto.quantidade}</td>
        <td><span class="badge ${statusClass}">${statusText}</span></td>
        <td>${produto.codigoBarras || 'N√£o gerado'}</td>
        <td style="text-align:right">
          <button class="btn btn-ghost btn-sm" onclick="selecionarProduto('${produto._id}')" title="Gerar c√≥digo de barras">
            üìã
          </button>
          <button class="btn btn-ghost btn-sm" onclick="editarProduto('${produto._id}')" title="Editar">
            ‚úèÔ∏è
          </button>
        </td>
      `;
    });
  }

  // Atualizar selects de produtos
  function atualizarSelectProdutos() {
    const selects = ['produtoSelect', 'produtoPreco'];
    
    selects.forEach(selectId => {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">Selecione um produto...</option>';
      
      produtosSistema.forEach(produto => {
        const option = document.createElement('option');
        option.value = produto._id;
        option.textContent = `${produto.codigo || produto.sku} - ${produto.nome}`;
        select.appendChild(option);
      });
    });
  }

  // Selecionar produto
  function selecionarProduto(produtoId) {
    const produto = produtosSistema.find(p => p._id === produtoId);
    if (produto) {
      document.getElementById('produtoSelect').value = produtoId;
      produtoSelecionado = produto;
      mostrarAlerta(`Produto selecionado: ${produto.nome}`, 'success');
      
      // Focar na aba de produtos se n√£o estiver ativa
      if (!document.getElementById('produtos').classList.contains('active')) {
        showTab('produtos');
        document.querySelector('[onclick="showTab(\'produtos\')"]').click();
      }
    }
  }

  // Editar produto (placeholder)
  function editarProduto(produtoId) {
    const produto = produtosSistema.find(p => p._id === produtoId);
    if (produto) {
      mostrarAlerta(`Funcionalidade de edi√ß√£o para ${produto.nome} em desenvolvimento`, 'warning');
    }
  }

  // Gerar c√≥digo de barras
  async function gerarCodigoBarras() {
    const produtoId = document.getElementById('produtoSelect').value;
    const tipo = document.getElementById('tipoCodigoBarras').value;
    
    if (!produtoId) {
      mostrarAlerta('Selecione um produto primeiro!', 'warning');
      return;
    }

    try {
      const codigo = gerarCodigoSimulado(tipo);
      
      document.getElementById('codigoNumero').textContent = codigo;
      document.getElementById('codigoBarrasResult').style.display = 'block';
      
      // Atualizar produto na lista
      const produto = produtosSistema.find(p => p._id === produtoId);
      if (produto) {
        produto.codigoBarras = codigo;
        produto.tipoCodigoBarras = tipo;
        atualizarTabelaProdutos();
      }
      
      mostrarAlerta('C√≥digo de barras gerado com sucesso!', 'success');
      
    } catch (error) {
      mostrarAlerta('Erro ao gerar c√≥digo de barras: ' + error.message, 'danger');
    }
  }

  // Simular gera√ß√£o de c√≥digo
  function gerarCodigoSimulado(tipo) {
    switch (tipo) {
      case 'EAN13':
        return '789' + Math.floor(Math.random() * 1000000000).toString().padStart(9, '0') + '0';
      case 'EAN8':
        return '78' + Math.floor(Math.random() * 100000).toString().padStart(5, '0') + '0';
      case 'CODE128':
        return 'C128' + Math.random().toString(36).substr(2, 8).toUpperCase();
      case 'CODE39':
        return '*' + Math.random().toString(36).substr(2, 8).toUpperCase() + '*';
      default:
        return '789' + Math.floor(Math.random() * 1000000000).toString().padStart(9, '0') + '0';
    }
  }

  // Atualizar pre√ßo
  async function atualizarPreco() {
    const produtoId = document.getElementById('produtoPreco').value;
    const novoPreco = parseFloat(document.getElementById('novoPreco').value);
    const motivo = document.getElementById('motivoAlteracao').value;
    const observacoes = document.getElementById('observacoesPreco').value;
    
    if (!produtoId || !novoPreco || !motivo) {
      mostrarAlerta('Preencha todos os campos obrigat√≥rios!', 'warning');
      return;
    }

    try {
      const produto = produtosSistema.find(p => p._id === produtoId);
      if (produto) {
        const precoAnterior = produto.preco;
        produto.preco = novoPreco;
        
        const variacao = ((novoPreco - precoAnterior) / precoAnterior * 100).toFixed(2);
        
        // Simular adi√ß√£o ao hist√≥rico
        adicionarAoHistorico({
          data: new Date(),
          produto: produto.nome,
          precoAnterior,
          novoPreco,
          variacao: parseFloat(variacao),
          motivo
        });
        
        atualizarTabelaProdutos();
        document.getElementById('novoPreco').value = '';
        document.getElementById('observacoesPreco').value = '';
        document.getElementById('motivoAlteracao').value = '';
        
        mostrarAlerta(`Pre√ßo atualizado! Varia√ß√£o: ${variacao > 0 ? '+' : ''}${variacao}%`, 'success');
      }
      
    } catch (error) {
      mostrarAlerta('Erro ao atualizar pre√ßo: ' + error.message, 'danger');
    }
  }

  // Hist√≥rico de pre√ßos (simulado)
  let historicoPrecos = [];

  function adicionarAoHistorico(entrada) {
    historicoPrecos.unshift(entrada);
    if (historicoPrecos.length > 50) {
      historicoPrecos = historicoPrecos.slice(0, 50);
    }
    atualizarTabelaHistorico();
  }

  function atualizarTabelaHistorico() {
    const tbody = document.getElementById('historicoTableBody');
    
    if (!historicoPrecos.length) {
      tbody.innerHTML = '<tr><td colspan="6" class="loading">Nenhuma altera√ß√£o registrada</td></tr>';
      return;
    }

    tbody.innerHTML = '';
    
    historicoPrecos.slice(0, 20).forEach(entrada => {
      const row = tbody.insertRow();
      const variacaoClass = entrada.variacao > 0 ? 'up' : entrada.variacao < 0 ? 'down' : '';
      const sinal = entrada.variacao > 0 ? '+' : '';
      
      row.innerHTML = `
        <td>${entrada.data.toLocaleDateString('pt-BR')} ${entrada.data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</td>
        <td>${entrada.produto}</td>
        <td>R$ ${entrada.precoAnterior.toFixed(2)}</td>
        <td>R$ ${entrada.novoPreco.toFixed(2)}</td>
        <td><span class="trend ${variacaoClass}">${sinal}${entrada.variacao.toFixed(2)}%</span></td>
        <td><span class="badge">${entrada.motivo}</span></td>
      `;
    });
  }

  function carregarHistoricoPrecos() {
    const produtoId = document.getElementById('produtoPreco').value;
    if (produtoId) {
      const produto = produtosSistema.find(p => p._id === produtoId);
      if (produto) {
        // Filtrar hist√≥rico por produto (simulado)
        atualizarTabelaHistorico();
      }
    }
  }

  // Buscar por c√≥digo
  function buscarPorCodigo() {
    const codigo = prompt('Digite o c√≥digo de barras:');
    if (!codigo) return;
    
    const produto = produtosSistema.find(p => p.codigoBarras === codigo);
    if (produto) {
      selecionarProduto(produto._id);
      mostrarAlerta(`Produto encontrado: ${produto.nome}`, 'success');
    } else {
      mostrarAlerta('Produto n√£o encontrado com este c√≥digo', 'warning');
    }
  }

  // Imprimir c√≥digo
  function imprimirCodigo() {
    const codigo = document.getElementById('codigoNumero').textContent;
    if (!codigo) {
      mostrarAlerta('Nenhum c√≥digo de barras para imprimir', 'warning');
      return;
    }
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html>
      <head>
        <title>C√≥digo de Barras - Milton Motos</title>
        <style>
          body { font-family: Inter, Arial, sans-serif; text-align: center; padding: 50px; background: white; color: black; }
          .header { color: #0D47A1; margin-bottom: 30px; }
          .barcode { font-family: 'Courier New', monospace; font-size: 2rem; margin: 20px 0; }
          .visual { font-size: 3rem; letter-spacing: 3px; color: #0D47A1; }
          .footer { margin-top: 30px; font-size: 0.9rem; color: #666; }
        </style>
      </head>
      <body>
        <div class="header">
          <h2>üèçÔ∏è Milton Motos e Pe√ßas</h2>
        </div>
        <div class="barcode">${codigo}</div>
        <div class="visual">||||| |||| | |||||||||</div>
        <div class="footer">
          <p>C√≥digo gerado em ${new Date().toLocaleString('pt-BR')}</p>
        </div>
      </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.print();
  }

  // Carregar produto selecionado
  function carregarProdutoSelecionado() {
    const produtoId = document.getElementById('produtoSelect').value;
    if (produtoId) {
      produtoSelecionado = produtosSistema.find(p => p._id === produtoId);
    }
  }

  // Gerar relat√≥rios
  async function gerarRelatorios() {
    const periodo = document.getElementById('periodoRelatorio').value;
    const container = document.getElementById('relatoriosContent');
    
    container.innerHTML = '<div class="loading">üîÑ Gerando relat√≥rios...</div>';
    
    setTimeout(() => {
      const totalProdutos = produtosSistema.length;
      const produtosBaixoEstoque = produtosSistema.filter(p => p.quantidade <= 20).length;
      const valorTotalEstoque = produtosSistema.reduce((total, p) => total + (p.preco * p.quantidade), 0);
      const mediaPrecos = produtosSistema.reduce((total, p) => total + p.preco, 0) / produtosSistema.length || 0;
      const totalAlteracoes = historicoPrecos.length;
      
      container.innerHTML = `
        <div class="kpis">
          <div class="kpi">
            <div class="label">Total de Produtos</div>
            <div class="value">${totalProdutos}</div>
          </div>
          <div class="kpi">
            <div class="label">Estoque Baixo</div>
            <div class="value">${produtosBaixoEstoque}</div>
            <div class="trend ${produtosBaixoEstoque > 0 ? 'down' : 'up'}">
              ${produtosBaixoEstoque > 0 ? 'Aten√ß√£o necess√°ria' : 'Tudo ok'}
            </div>
          </div>
          <div class="kpi">
            <div class="label">Valor Total</div>
            <div class="value">R$ ${valorTotalEstoque.toFixed(2)}</div>
          </div>
          <div class="kpi">
            <div class="label">Pre√ßo M√©dio</div>
            <div class="value">R$ ${mediaPrecos.toFixed(2)}</div>
          </div>
        </div>
        
        <div style="margin-top:30px;">
          <h3 style="margin-bottom:16px; font-size:16px;">üèÜ Top Produtos por Valor em Estoque</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Quantidade</th>
                  <th>Pre√ßo Unit.</th>
                  <th>Valor Total</th>
                </tr>
              </thead>
              <tbody>
                ${produtosSistema
                  .sort((a, b) => (b.preco * b.quantidade) - (a.preco * a.quantidade))
                  .slice(0, 5)
                  .map(produto => `
                    <tr>
                      <td>${produto.nome}</td>
                      <td>${produto.quantidade}</td>
                      <td>R$ ${produto.preco.toFixed(2)}</td>
                      <td><strong>R$ ${(produto.preco * produto.quantidade).toFixed(2)}</strong></td>
                    </tr>
                  `).join('')}
              </tbody>
            </table>
          </div>
        </div>
        
        <div style="margin-top:30px;">
          <h3 style="margin-bottom:16px; font-size:16px;">üìà Resumo de Altera√ß√µes de Pre√ßo</h3>
          <div class="kpis">
            <div class="kpi">
              <div class="label">Total de Altera√ß√µes</div>
              <div class="value">${totalAlteracoes}</div>
            </div>
            <div class="kpi">
              <div class="label">√öltimas 24h</div>
              <div class="value">${historicoPrecos.filter(h => 
                (new Date() - h.data) < 24 * 60 * 60 * 1000
              ).length}</div>
            </div>
            <div class="kpi">
              <div class="label">Produtos com C√≥digo</div>
              <div class="value">${produtosSistema.filter(p => p.codigoBarras).length}</div>
            </div>
            <div class="kpi">
              <div class="label">Taxa de Cobertura</div>
              <div class="value">${totalProdutos > 0 ? 
                Math.round((produtosSistema.filter(p => p.codigoBarras).length / totalProdutos) * 100) : 0}%</div>
            </div>
          </div>
        </div>
      `;
      
      mostrarAlerta('Relat√≥rios gerados com sucesso!', 'success');
    }, 1500);
  }

  // Filtro de pesquisa
  document.getElementById('searchProdutos').addEventListener('input', function(e) {
    const termo = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#produtosTableBody tr');
    
    rows.forEach(row => {
      const texto = row.textContent.toLowerCase();
      row.style.display = texto.includes(termo) ? '' : 'none';
    });
  });

  // Verificar status da API
  async function verificarAPI() {
    try {
      const response = await fetch(`${API_BASE}/status`);
      if (response.ok) {
        const data = await response.json();
        console.log('‚úÖ API de estoque conectada:', data);
        mostrarAlerta('Sistema de estoque avan√ßado ativado! üöÄ', 'success');
      } else {
        console.log('‚ö†Ô∏è API de estoque n√£o encontrada, usando modo simula√ß√£o');
        mostrarAlerta('Modo demonstra√ß√£o ativo. Configure a API para funcionalidade completa.', 'warning');
      }
    } catch (error) {
      console.log('‚ö†Ô∏è API n√£o configurada, usando dados de exemplo');
      mostrarAlerta('Sistema funcionando em modo demonstra√ß√£o', 'warning');
    }
  }

  // Inicializar aplica√ß√£o
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Iniciando sistema de gest√£o de estoque avan√ßado...');
    verificarAPI();
    carregarProdutos();
    
    // Simular alguns dados de hist√≥rico
    setTimeout(() => {
      adicionarAoHistorico({
        data: new Date(Date.now() - 86400000), // 1 dia atr√°s
        produto: 'Filtro de √ìleo Honda',
        precoAnterior: 27.90,
        novoPreco: 29.90,
        variacao: 7.17,
        motivo: 'ajuste_custo'
      });
      
      adicionarAoHistorico({
        data: new Date(Date.now() - 172800000), // 2 dias atr√°s
        produto: 'Pastilha de Freio Yamaha',
        precoAnterior: 65.90,
        novoPreco: 59.90,
        variacao: -9.11,
        motivo: 'promocao'
      });
    }, 1000);
  });

  // Atalhos de teclado
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'g') {
      e.preventDefault();
      gerarCodigoBarras();
    }
    
    if (e.ctrlKey && e.key === 'f') {
      e.preventDefault();
      document.getElementById('searchProdutos').focus();
    }
    
    if (e.ctrlKey && e.key === 'r') {
      e.preventDefault();
      carregarProdutos();
    }
  });

  

  console.log(`
üèçÔ∏è SISTEMA DE ESTOQUE AVAN√áADO - MILTON MOTOS
============================================

‚úÖ Funcionalidades Ativas:
‚Ä¢ Interface integrada ao design existente
‚Ä¢ C√≥digo de Barras (EAN-13, EAN-8, Code 128, Code 39)
‚Ä¢ Hist√≥rico de Pre√ßos com motivos
‚Ä¢ Relat√≥rios em tempo real
‚Ä¢ Busca avan√ßada por produtos

üéØ Atalhos de Teclado:
‚Ä¢ Ctrl + G: Gerar c√≥digo de barras
‚Ä¢ Ctrl + F: Focar na busca
‚Ä¢ Ctrl + R: Atualizar produtos

üì± Totalmente Responsivo e Acess√≠vel
üîÑ Pronto para integrar com sua API existente
  `);
</script>

<!-- Adicionar footer se necess√°rio -->
<footer style="color:var(--muted); text-align:center; padding:26px 16px; margin-top:40px">
  ¬© <span id="ano-footer"></span> Milton Motos e Pe√ßas ‚Äî Todos os direitos reservados.
</footer>

<script>
  // Preencher ano do footer
  document.getElementById('ano-footer').textContent = new Date().getFullYear();
</script>

</body>
</html>